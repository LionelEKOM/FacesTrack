{% extends 'dashboard_base.html' %}
{% load static %}

{% block title %}Mes Cours - FaceTrack{% endblock %}

{% block sidebar %}
{% include 'sidebar_teacher.html' %}
{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="page-header">
    <div class="d-flex justify-content-between align-items-center">
        <div>
            <h2 class="mb-1">Mes Cours</h2>
            <p class="text-muted mb-0">Gestion des cours et prise de présence</p>
        </div>
        <div class="d-flex gap-2">
            <button class="btn btn-outline-primary" onclick="window.print()">
                <i class="fas fa-print me-2"></i>Imprimer
            </button>
            <button class="btn btn-outline-success" onclick="exportCours()">
                <i class="fas fa-download me-2"></i>Exporter
            </button>
        </div>
    </div>
</div>

<!-- Filtres de la semaine -->
<div class="row mb-4">
    <div class="col-md-6">
        <div class="dashboard-card">
            <div class="card-header">
                <h3 class="card-title">Semaine du {{ debut_semaine|date:"d/m/Y" }} au {{ fin_semaine|date:"d/m/Y" }}
                </h3>
                <div class="card-icon primary">
                    <i class="fas fa-calendar-week"></i>
                </div>
            </div>
            <div class="card-content">
                <div class="d-flex gap-2">
                    <button class="btn btn-sm btn-outline-primary" onclick="changeWeek(-1)">
                        <i class="fas fa-chevron-left"></i> Semaine précédente
                    </button>
                    <button class="btn btn-sm btn-outline-primary" onclick="changeWeek(1)">
                        Semaine suivante <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="dashboard-card">
            <div class="card-header">
                <h3 class="card-title">Statistiques de la semaine</h3>
                <div class="card-icon accent">
                    <i class="fas fa-chart-pie"></i>
                </div>
            </div>
            <div class="card-content">
                <div class="row text-center">
                    <div class="col-4">
                        <div class="stat-item">
                            <div class="stat-value text-primary">{{ cours_semaine.count }}</div>
                            <div class="stat-label">Cours</div>
                        </div>
                    </div>
                    <div class="col-4">
                        <div class="stat-item">
                            <div class="stat-value text-success">{{ cours_semaine|length }}</div>
                            <div class="stat-label">Terminés</div>
                        </div>
                    </div>
                    <div class="col-4">
                        <div class="stat-value text-warning">{{ cours_semaine|length }}</div>
                        <div class="stat-label">Planifiés</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Liste des cours -->
<div class="dashboard-card">
    <div class="card-header">
        <h3 class="card-title">Planning de la semaine</h3>
        <div class="card-icon blue">
            <i class="fas fa-list"></i>
        </div>
    </div>

    {% if cours_semaine %}
    <div class="table-responsive">
        <table class="table table-hover">
            <thead>
                <tr>
                    <th>Jour</th>
                    <th>Horaire</th>
                    <th>Matière</th>
                    <th>Classe</th>
                    <th>Salle</th>
                    <th>Statut</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for cours in cours_semaine %}
                <tr class="{% if cours.date == aujourd_hui %}table-primary{% endif %}">
                    <td>
                        <div class="d-flex align-items-center">
                            <div class="day-badge me-2">
                                {{ cours.date|date:"l"|slice:":3"|upper }}
                            </div>
                            <div>
                                <div class="fw-bold">{{ cours.date|date:"d/m" }}</div>
                                <small class="text-muted">{{ cours.date|date:"Y" }}</small>
                            </div>
                        </div>
                    </td>
                    <td>
                        <div class="time-slot">
                            <div class="fw-bold">{{ cours.heure_debut|time:"H:i" }}</div>
                            <div class="text-muted">{{ cours.heure_fin|time:"H:i" }}</div>
                        </div>
                    </td>
                    <td>
                        <div class="subject-info">
                            <div class="fw-bold">{{ cours.matiere.nom }}</div>
                            <small class="text-muted">{{ cours.matiere.code }}</small>
                        </div>
                    </td>
                    <td>
                        <div class="class-info">
                            <div class="fw-bold">{{ cours.classe.nom }}</div>
                            <small class="text-muted">{{ cours.classe.niveau }}</small>
                        </div>
                    </td>
                    <td>
                        <span class="badge bg-secondary">{{ cours.salle|default:"--" }}</span>
                    </td>
                    <td>
                        {% if cours.statut == 'PLANIFIE' %}
                        <span class="badge bg-warning">Planifié</span>
                        {% elif cours.statut == 'EN_COURS' %}
                        <span class="badge bg-success">En cours</span>
                        {% elif cours.statut == 'TERMINE' %}
                        <span class="badge bg-secondary">Terminé</span>
                        {% elif cours.statut == 'ANNULE' %}
                        <span class="badge bg-danger">Annulé</span>
                        {% endif %}
                    </td>
                    <td>
                        <div class="btn-group btn-group-sm">
                            {% if cours.date == aujourd_hui and cours.statut == 'PLANIFIE' %}
                            <a href="{% url 'scan_qr_eleves' cours.id %}" class="btn btn-success">
                                <i class="fas fa-camera"></i> Appel
                            </a>
                            {% elif cours.statut == 'EN_COURS' %}
                            <a href="{% url 'scan_qr_eleves' cours.id %}" class="btn btn-primary">
                                <i class="fas fa-play"></i> Continuer
                            </a>
                            {% elif cours.statut == 'TERMINE' %}
                            <button class="btn btn-outline-info" onclick="viewAttendance({{ cours.id }})">
                                <i class="fas fa-eye"></i> Voir
                            </button>
                            {% endif %}

                            <button class="btn btn-outline-secondary" onclick="editCours({{ cours.id }})">
                                <i class="fas fa-edit"></i>
                            </button>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="text-center py-5">
        <i class="fas fa-calendar-times fa-3x text-muted mb-3"></i>
        <h4 class="text-muted">Aucun cours cette semaine</h4>
        <p class="text-muted">Vous n'avez pas de cours programmés pour cette période.</p>
    </div>
    {% endif %}
</div>

<!-- Actions rapides -->
<div class="row mt-4">
    <div class="col-md-6">
        <div class="dashboard-card">
            <div class="card-header">
                <h3 class="card-title">Actions rapides</h3>
                <div class="card-icon green">
                    <i class="fas fa-bolt"></i>
                </div>
            </div>
            <div class="card-content">
                <div class="d-grid gap-2">
                    <button class="btn btn-outline-primary" onclick="createCours()">
                        <i class="fas fa-plus me-2"></i>Créer un nouveau cours
                    </button>
                    <button class="btn btn-outline-success" onclick="importCours()">
                        <i class="fas fa-upload me-2"></i>Importer un planning
                    </button>
                    <button class="btn btn-outline-info" onclick="exportPlanning()">
                        <i class="fas fa-download me-2"></i>Exporter le planning
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="dashboard-card">
            <div class="card-header">
                <h3 class="card-title">Prochains cours</h3>
                <div class="card-icon purple">
                    <i class="fas fa-clock"></i>
                </div>
            </div>
            <div class="card-content">
                {% if cours_semaine %}
                {% for cours in cours_semaine|slice:":3" %}
                <div class="upcoming-course mb-2 p-2 border rounded">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <strong>{{ cours.matiere.nom }}</strong>
                            <br>
                            <small class="text-muted">{{ cours.classe.nom }} - {{ cours.heure_debut|time:"H:i"
                                }}</small>
                        </div>
                        <span class="badge bg-primary">{{ cours.date|date:"d/m" }}</span>
                    </div>
                </div>
                {% endfor %}
                {% else %}
                <p class="text-muted text-center">Aucun cours à venir</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
    .day-badge {
        width: 40px;
        height: 40px;
        background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 0.8rem;
    }

    .time-slot {
        text-align: center;
    }

    .subject-info,
    .class-info {
        line-height: 1.2;
    }

    .upcoming-course {
        transition: all 0.3s ease;
    }

    .upcoming-course:hover {
        background: rgba(247, 147, 32, 0.05);
        transform: translateX(5px);
    }

    .table-primary {
        background: rgba(247, 147, 32, 0.1) !important;
    }

    @media print {

        .btn,
        .page-header .d-flex:last-child {
            display: none !important;
        }

        .dashboard-card {
            box-shadow: none !important;
            border: 1px solid #ddd !important;
        }
    }
</style>
{% endblock %}

{% block extra_js %}
<script>
    function changeWeek(direction) {
        // Implémentation du changement de semaine
        console.log('Changement de semaine:', direction);
        // En production, rediriger vers une nouvelle URL avec les paramètres de date
    }

    function viewAttendance(coursId) {
        // Voir les présences d'un cours
        console.log('Voir présences pour le cours:', coursId);
        // Rediriger vers la page des présences
    }

    function editCours(coursId) {
        // Éditer un cours
        console.log('Éditer le cours:', coursId);
        // Ouvrir un modal ou rediriger vers la page d'édition
    }

    function createCours() {
        // Créer un nouveau cours
        console.log('Créer un nouveau cours');
        // Ouvrir un modal ou rediriger vers la page de création
    }

    function importCours() {
        // Importer un planning
        console.log('Importer un planning');
        // Ouvrir un modal d'import
    }

    function exportPlanning() {
        // Exporter le planning
        console.log('Exporter le planning');
        // Télécharger le fichier
    }

    function exportCours() {
        // Exporter les cours
        console.log('Exporter les cours');
        // Télécharger le fichier
    }
</script>
{% endblock %}